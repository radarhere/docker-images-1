FROM i386/ubuntu:bionic

ARG PLATFORM=i686
RUN apt update
RUN apt install -y gnupg
# Script to choose Python version
# Installer script for Pythons
COPY build_install_pythons.sh /

# Install Pythons and matching pips
RUN linux32 bash build_install_pythons.sh && rm build_install_pythons.sh

# Install manylinux1 libraries. See:
# https://www.python.org/dev/peps/pep-0513/#the-manylinux1-policy
# https://github.com/matthew-brett/multibuild/issues/106
RUN apt-get update && \
        apt-get install -y libncurses5 libgcc1 libstdc++6 libc6 libx11-6 libxext6 \
        libxrender1 libice6 libsm6 libgl1-mesa-glx libglib2.0-0

# Get virtualenv
RUN pip3.6 install --user virtualenv

# Run Python selection on way into image
# Set 32-bit uname via `linux32`
COPY choose_python.sh /usr/bin/
ENTRYPOINT ["linux32", "/usr/bin/choose_python.sh"]
